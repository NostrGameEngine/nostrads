/*! For license information please see nostrads-client.js.LICENSE.txt */
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.NostrAds=n():e.NostrAds=n()}(this,()=>(()=>{"use strict";var e={445:(e,n,r)=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function o(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}function i(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,a(t.key),t)}}function a(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}r.d(n,{default:()=>W});const c=function(){return e=function e(n,r){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.callbacks={},"undefined"==typeof SharedWorker||null!=r&&r.forceCompat){console.log("Using SharedWorker compatibility mode");var t=new Worker(n,r);t.addEventListener("message",this.handleMessage.bind(this)),this.worker=t,this.compatMode=!0}else{console.log("Using native SharedWorker");var o=new SharedWorker(n,r);o.port.start(),o.port.addEventListener("message",this.handleMessage.bind(this)),this.worker=o.port,this.sharedWorker=o,this.compatMode=!1}},n=[{key:"isNativeSupported",value:function(){return"undefined"!=typeof SharedWorker}},{key:"isNative",value:function(){return!this.compatMode}},{key:"registerCallback",value:function(e,n){this.callbacks[e]=n,this.worker.postMessage(JSON.stringify({type:"registerCallback",name:e}))}},{key:"unregisterCallback",value:function(e){this.worker.postMessage(JSON.stringify({type:"unregisterCallback",name:e}))}},{key:"invoke",value:function(e){for(var n=this,r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return new Promise(function(r,o){var i="".concat(n.worker.id,"-").concat(Math.random().toString(36).substring(2,15),"-").concat(Date.now()),a=function(e){var t=JSON.parse(e.data);if("result"===t.type&&t.invkId===i){t.error?o(new Error(t.error)):r(t.result);try{n.worker.removeEventListener("message",a)}catch(e){console.warn("Could not remove event listener:",e)}}};n.worker.addEventListener("message",a),n.worker.postMessage(JSON.stringify({type:"invoke",method:e,args:t,invkId:i}))})}},{key:"triggerCallback",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];this.worker.postMessage(JSON.stringify({type:"callback",name:e,args:r}))}},{key:"close",value:function(){this.worker instanceof MessagePort?this.worker.close():this.worker.terminate()}},{key:"handleMessage",value:function(e){if(function(e){var n,r,t=[null!==(n=self.location.origin)&&void 0!==n?n:window.location.origin];if((function(e){var n=null==e?void 0:e.target;return"undefined"!=typeof MessagePort&&n instanceof MessagePort}(e)||function(e){var n,r=null==e?void 0:e.target;return"undefined"!=typeof Worker&&r instanceof Worker||!(!("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope)||r!==self&&"DedicatedWorkerGlobalScope"!==(null==r||null===(n=r.constructor)||void 0===n?void 0:n.name))}(e)||function(e){var n,r=null!==(n=null==e?void 0:e.currentTarget)&&void 0!==n?n:null==e?void 0:e.target;return"undefined"!=typeof BroadcastChannel&&r instanceof BroadcastChannel}(e))&&t.push(""),!t.includes(null!==(r=e.origin)&&void 0!==r?r:""))throw new Error("Untrusted origin: ".concat(e.origin," not in ").concat(t.join(", ")))}(e),"string"==typeof e.data){var n,r,t=JSON.parse(e.data);"callback"===t.type&&(null===(n=(r=this.callbacks)[t.name])||void 0===n||n.call.apply(n,[r].concat(function(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return o(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.args))))}}}],n&&i(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();function s(e,n,r,t){var o=n.mimeType,i=n.payload,a=n.link,c=n.description,s=n.actionType,u=n.callToAction,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},f=[];if("image/jpeg"===o||"image/png"===o||"image/png"===o||"image/gif"===o)e.textContent="",e.style.backgroundImage="url(".concat(i,")"),e.style.backgroundSize="contain",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.style.cursor="pointer";else{if("text/plain"!==o)return console.error("Unsupported mime type:",o),void t("Unsupported mime type: "+o);e.style.backgroundImage="",e.textContent=i}var d=e.querySelector(".nostr-ddspace-description");d||((d=document.createElement("div")).className="nostr-ddspace-description",e.appendChild(d)),d.textContent=c||"",d.style.visibility=c?"visible":"hidden";var p=e.querySelector(".nostr-ddspace-call-to-action");p||((p=document.createElement("div")).className="nostr-ddspace-call-to-action",e.appendChild(p)),u?(p.textContent=u,p.style.visibility="visible"):(p.textContent="Learn More",p.style.visibility="hidden");var y=e.querySelector(".nostr-ddspace-icon");if(y||((y=document.createElement("div")).className="nostr-ddspace-icon",e.appendChild(y)),l.noLink||e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),"link"===s&&r(),window.open(a,"_blank")}),"attention"===s){var v=!1,m=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&!v&&(v=!0,r(),m.disconnect())})});f.push(function(){m.disconnect()}),m.observe(e)}else"view"===s&&r();return f}const u=function(e,n,r,t){var o,i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=JSON.parse(n.content),u=c.link,l=n.tags||[];return s(e,{mimeType:null===(o=l.find(function(e){return"m"===e[0]}))||void 0===o?void 0:o[1],payload:c.payload,link:u,description:c.description||"",actionType:null===(i=l.find(function(e){return"k"===e[0]}))||void 0===i?void 0:i[1],callToAction:c.call_to_action},r,t,a)};function l(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=d(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function f(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i,a,c=[],s=!0,u=!1;try{if(i=(r=r.call(e)).next,0===n){if(Object(r)!==r)return;s=!1}else for(;!(s=(t=i.call(r)).done)&&(c.push(t.value),c.length!==n);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(e,n)||d(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,n){if(e){if("string"==typeof e)return p(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,n):void 0}}function p(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}function y(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,t,o,i){var s=t&&t.prototype instanceof c?t:c,u=Object.create(s.prototype);return v(u,"_invoke",function(r,t,o){var i,c,s,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,r){return i=n,c=0,s=e,d.n=r,a}};function p(r,t){for(c=r,s=t,n=0;!f&&u&&!o&&n<l.length;n++){var o,i=l[n],p=d.p,y=i[2];r>3?(o=y===t)&&(s=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=t,d.n=i[1]):p<y&&(o=r<3||i[0]>t||t>y)&&(i[4]=r,i[5]=t,d.n=y,c=0))}if(o||r>1)return a;throw f=!0,t}return function(o,l,y){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,y),c=l,s=y;(n=c<2?e:s)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,s)):d.n=s:d.v=s);try{if(u=2,i){if(c||(o="next"),n=i[o]){if(!(n=n.call(i,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,c<2&&(c=0)}else 1===c&&(n=i.return)&&n.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((n=(f=d.n<0)?s:r.call(t,d))!==a)break}catch(n){i=e,c=1,s=n}finally{u=1}}return{value:n,done:f}}}(r,o,i),!0),u}var a={};function c(){}function s(){}function u(){}n=Object.getPrototypeOf;var l=[][t]?n(n([][t]())):(v(n={},t,function(){return this}),n),f=u.prototype=c.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,v(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,v(f,"constructor",u),v(u,"constructor",s),s.displayName="GeneratorFunction",v(u,o,"GeneratorFunction"),v(f),v(f,o,"Generator"),v(f,t,function(){return this}),v(f,"toString",function(){return"[object Generator]"}),(y=function(){return{w:i,m:d}})()}function v(e,n,r,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}v=function(e,n,r,t){function i(n,r){v(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r:(i("next",0),i("throw",1),i("return",2))},v(e,n,r,t)}function m(e,n,r,t,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void r(e)}c.done?n(s):Promise.resolve(s).then(t,o)}function h(e){return function(){var n=this,r=arguments;return new Promise(function(t,o){var i=e.apply(n,r);function a(e){m(i,t,o,a,c,"next",e)}function c(e){m(i,t,o,a,c,"throw",e)}a(void 0)})}}function g(){return b.apply(this,arguments)}function b(){return(b=h(y().m(function e(){var n;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"undefined"!=typeof indexedDB){e.n=1;break}throw new Error("IndexedDB is not available");case 1:return e.a(2,new Promise(function(e){var n=indexedDB.open("nostrads",1);n.onupgradeneeded=function(e){var n=e.target.result;n.objectStoreNames.contains("counters")||n.createObjectStore("counters",{keyPath:"id"})},n.onsuccess=function(n){var r=n.target.result.transaction(["counters"],"readwrite").objectStore("counters"),t=r.get("instanceCounter");t.onsuccess=function(){var n=1;t.result&&(n=t.result.value+1),r.put({id:"instanceCounter",value:n}),e(n)},t.onerror=function(){e(Date.now())}},n.onerror=function(){e(Date.now())}}));case 2:return e.p=2,n=e.v,console.warn("Using fallback for ID generation:",n),e.a(2,Date.now())}},e,null,[[0,2]])}))).apply(this,arguments)}function w(e,n){return k.apply(this,arguments)}function k(){return(k=h(y().m(function e(n,r){var t,o,i,a,c,s,u,l,f,d,p,v,m,h,b;return y().w(function(e){for(;;)switch(e.n){case 0:for(t={},o=0,i=["appKey","priceSlot","mimeTypes","category","languages","advertisersWhitelist"];o<i.length;o++)a=i[o],null!==(c=n.getAttribute("nostrads-"+a))&&(t[a]="mimeTypes"===a||"category"===a||"languages"===a||"advertisersWhitelist"===a?c.split(",").map(function(e){return e.trim()}):c);if(s=n.getBoundingClientRect(),t.width=Math.floor(s.width),t.height=Math.floor(s.height),t.width&&t.height){e.n=1;break}return e.a(2,null);case 1:if(u=n.getAttribute("nostrads-uid")){e.n=3;break}return e.n=2,g();case 2:m=e.v,h=m+"-",b=Date.now(),u=h+b,n.setAttribute("nostrads-uid",u),e.n=4;break;case 3:u=u.trim();case 4:return t.uid=u,t.appKey||(t.appKey=null==r?void 0:r.appKey),t.priceSlot||(t.priceSlot=null!==(l=r.priceSlot)&&void 0!==l?l:"BTC1_000"),t.category||(t.category=null!==(f=r.category)&&void 0!==f?f:[]),t.languages||(t.languages=null!==(d=r.languages)&&void 0!==d?d:[]),t.advertisersWhitelist||(t.advertisersWhitelist=null!==(p=r.advertisersWhitelist)&&void 0!==p?p:[]),t.mimeTypes&&0!==t.mimeTypes.length||(t.mimeTypes=null!==(v=r.mimeTypes)&&void 0!==v?v:["image/gif","image/png","image/jpeg","text/plain"]),e.a(2,t)}},e)}))).apply(this,arguments)}e=r.hmd(e);var S,E={};function j(e,n,r){return O.apply(this,arguments)}function O(){return O=h(y().m(function e(n,r,t){return y().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,o){requestAnimationFrame(h(y().m(function o(){var i,a,c,s,l,d,p,v;return y().w(function(o){for(;;)switch(o.p=o.n){case 0:return o.p=0,o.n=1,w(n,r);case 1:if(i=o.v){o.n=2;break}return e(),o.a(2);case 2:if(a={},c=!!E[i.uid],E[i.uid]=[n,i,a],c){o.n=3;break}return o.n=3,S.invoke("registerAdspace",i);case 3:return t=t?Math.floor(Math.min(1.8*t,2e4)):1500,o.n=4,S.invoke("loadAd",i);case 4:s=o.v,l=f(s,2),d=l[0],p=l[1],a.offerId=p,u(n,d,h(y().m(function e(){return y().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,S.invoke("confirmAd",p);case 1:t=0;case 2:return e.a(2)}},e)})),function(){var e=h(y().m(function e(o){return y().w(function(e){for(;;)switch(e.n){case 0:return console.error("Error rendering ad for element:",n,o),e.n=1,S.invoke("cancelAd",p);case 1:setTimeout(h(y().m(function e(){return y().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,j(n,r,t);case 1:return e.a(2)}},e)})),t);case 2:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}()),e(),o.n=6;break;case 5:o.p=5,v=o.v,console.error("Error preparing ad space for element:",n,v),console.log("Retrying in ",t,"ms"),setTimeout(h(y().m(function e(){return y().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,j(n,r,t);case 1:return e.a(2)}},e)})),t);case 6:return o.a(2)}},o,null,[[0,5]])})))}))},e)})),O.apply(this,arguments)}function A(e,n){return T.apply(this,arguments)}function T(){return(T=h(y().m(function e(n,r){var t;return y().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,w(n,r);case 1:if(null!=(t=e.v)){e.n=2;break}return e.a(2);case 2:E[t.uid]&&delete E[t.uid];case 3:return e.a(2)}},e)}))).apply(this,arguments)}function x(){return C.apply(this,arguments)}function C(){return(C=h(y().m(function e(){var n,r,t,o,i,a;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:n=0,r=Object.values(E);case 1:if(!(n<r.length)){e.n=6;break}return t=f(r[n],2),o=t[0],i=t[1],e.p=2,e.n=3,S.invoke("pong",i.uid);case 3:e.n=5;break;case 4:e.p=4,a=e.v,console.error("Error pinging adspace for element:",o,a);case 5:n++,e.n=1;break;case 6:return e.a(2)}},e,null,[[2,4]])}))).apply(this,arguments)}function M(e,n){return P.apply(this,arguments)}function P(){return(P=h(y().m(function e(n,r){var t,o,i,a,c;return y().w(function(e){for(;;)switch(e.n){case 0:t=0,o=Object.entries(E);case 1:if(!(t<o.length)){e.n=4;break}if((i=f(o[t],2))[0],a=f(i[1],3),c=a[0],a[1],a[2].offerId!==n){e.n=3;break}return e.n=2,j(c,r);case 2:return e.a(3,4);case 3:t++,e.n=1;break;case 4:return e.a(2)}},e)}))).apply(this,arguments)}function N(e,n){return I.apply(this,arguments)}function I(){return I=h(y().m(function e(n,r){var t,o,i;return y().w(function(e){for(;;)switch(e.n){case 0:if(null!=r){e.n=1;break}return e.a(2,new Promise(function(e,r){"loading"!==document.readyState?N(n,document.body).then(e).catch(r):window.addEventListener("load",function(){N(n,document.body).then(e).catch(r)})}));case 1:if(n||(n={}),n.appKey){e.n=2;break}throw new Error("App key is required. Please provide a valid appKey in globalOptions.");case 2:if(n.relays||(n.devMode?n.relays=["wss://nostr.rblb.it"]:n.relays=["wss://relay.ngengine.org","wss://relay2.ngengine.org","wss://relay.damus.io","wss://relay.primal.net","wss://relay.nostr.band"]),t=!1,S||(S=new c(null!==(o=n.worker)&&void 0!==o?o:"nostrads-worker.js",{type:"module",forceCompat:n.forceCompatModeForWorker}),t=!0),n.userKey){e.n=4;break}return e.n=3,S.invoke("generatePrivateKey");case 3:n.userKey=e.v;case 4:if(!t){e.n=5;break}return S.registerCallback("invalidateAd",function(e){M(e,n)}),S.registerCallback("ping",function(){x()}),e.n=5,S.invoke("initDisplay",n);case 5:i=new MutationObserver(function(e){e.forEach(function(){var e=h(y().m(function e(r){var t,o,i,a,c,s,u,f,d,p;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:t=l(r.addedNodes),e.p=1,t.s();case 2:if((o=t.n()).done){e.n=8;break}if(i=o.value,e.p=3,i.nodeType===Node.ELEMENT_NODE&&i.classList.contains("nostr-ddspace")){e.n=4;break}return e.a(3,7);case 4:return e.n=5,j(i,n);case 5:e.n=7;break;case 6:e.p=6,u=e.v,console.error("Error processing added node:",u);case 7:e.n=2;break;case 8:e.n=10;break;case 9:e.p=9,f=e.v,t.e(f);case 10:return e.p=10,t.f(),e.f(10);case 11:a=l(r.removedNodes),e.p=12,a.s();case 13:if((c=a.n()).done){e.n=18;break}if(s=c.value,e.p=14,s.nodeType===Node.ELEMENT_NODE&&s.classList.contains("nostr-ddspace")){e.n=15;break}return e.a(3,17);case 15:A(s,n),e.n=17;break;case 16:e.p=16,d=e.v,console.error("Error processing removed node:",d);case 17:e.n=13;break;case 18:e.n=20;break;case 19:e.p=19,p=e.v,a.e(p);case 20:return e.p=20,a.f(),e.f(20);case 21:return e.a(2)}},e,null,[[14,16],[12,19,20,21],[3,6],[1,9,10,11]])}));return function(n){return e.apply(this,arguments)}}())}),i.observe(r,{childList:!0,subtree:!0}),r.querySelectorAll(".nostr-ddspace").forEach(function(){var e=h(y().m(function e(r){return y().w(function(e){for(;;)switch(e.n){case 0:try{j(r,n)}catch(e){console.error("Error loading ad for element:",r,e)}case 1:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}());case 6:return e.a(2)}},e)})),I.apply(this,arguments)}const W=N;e.exports&&(e.exports=N)}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var i=n[t]={id:t,loaded:!1,exports:{}};return e[t](i,i.exports,r),i.loaded=!0,i.exports}r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var t=r(445);return t.default})());